<% layout("/layouts/boilerplate") -%>

<div class="container mt-4 mb-5">
  <h2 class="text-center mb-4">Book: <%= sportItem.title %></h2>

  <!-- Show already booked slots -->
  <div class="existing-bookings mt-3 mb-4 p-3 border rounded bg-light text-center">
    <h5 class="text-center">Already Booked Slots:</h5>
    <% if (existingBookings.length === 0) { %>
      <p class="text-muted text-center">No bookings yet. Be the first!</p>
    <% } else { %>
      <ul class="list-unstyled">
        <% for (let b of existingBookings) { %>
          <li class="mb-1">
            <i class="fa-regular fa-clock me-1"></i>
            <strong><%= b.startAt.toLocaleString() %></strong> â€”
            <%= b.endAt.toLocaleString() %>
          </li>
        <% } %>
      </ul>
    <% } %>
  </div>

  <!-- Booking form -->
  <form method="POST" action="/sportItems/<%= sportItem._id %>/book" class="p-4 border rounded shadow-sm bg-white">
    <div class="mb-3">
      <label for="startAt" class="form-label fw-bold">Start Date & Time</label>
      <input type="datetime-local" id="startAt" name="startAt" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="endAt" class="form-label fw-bold">End Date & Time</label>
      <input type="datetime-local" id="endAt" name="endAt" class="form-control" required>
    </div>

    <div class="mb-3">
      <label for="note" class="form-label fw-bold">Optional Note</label>
      <textarea id="note" name="note" rows="3" class="form-control" placeholder="Any special requests?"></textarea>
    </div>

    <button type="submit" class="btn btn-success w-100 py-2">Confirm Booking</button>
  </form>
</div>

<!-- Small script to handle min values and prevent invalid selection -->
<script>
  const start = document.getElementById('startAt');
  const end = document.getElementById('endAt');

  // User cannot pick past time
  start.min = new Date().toISOString().slice(0,16);

  // When start changes, end time must be after start
  function setMinEnd() {
    if (start.value) {
      end.min = start.value;
    }
  }

  start.addEventListener('change', setMinEnd);
</script>

<!-- Optional styling for better layout -->
<style>
  .existing-bookings ul {
    padding-left: 0;
    margin: 0;
  }
  .existing-bookings li {
    background: #f1f1f1;
    border-radius: 6px;
    padding: 0.4rem 0.8rem;
    margin-bottom: 0.4rem;
  }
  form {
    max-width: 500px;
    margin: 0 auto;
  }
  h2 {
    font-weight: 600;
  }
</style>
